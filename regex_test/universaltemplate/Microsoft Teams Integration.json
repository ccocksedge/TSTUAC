{
    "agent": null,
    "agentCluster": null,
    "agentClusterVar": null,
    "agentFieldsRestriction": "No Restriction",
    "agentType": "Any",
    "agentVar": null,
    "alwaysCancelOnFinish": false,
    "autoCleanup": false,
    "automaticOutputRetrievalFieldsRestriction": "No Restriction",
    "broadcastCluster": null,
    "broadcastClusterVar": null,
    "commands": [],
    "createConsole": false,
    "credentialFieldsRestriction": "No Restriction",
    "credentials": null,
    "credentialsVar": null,
    "description": "Universal Task for Microsoft teams Notificaitons through webhooks",
    "desktopInteract": false,
    "elevateUser": false,
    "environment": [],
    "environmentVariablesFieldsRestriction": "No Restriction",
    "events": [],
    "exitCodeOutput": null,
    "exitCodeProcessing": "Success Exitcode Range",
    "exitCodeProcessingFieldsRestriction": "No Restriction",
    "exitCodeText": null,
    "exitCodes": "0",
    "exportReleaseLevel": "7.4.0.0",
    "extension": null,
    "fields": [
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [
                {
                    "fieldValue": "Send Message",
                    "sequence": 0,
                    "sysId": "cd55b624f8ad4589aee4a35c493a7ab5",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Approval Notification",
                    "sequence": 1,
                    "sysId": "fcb023d9633c4e618e352be3ae6ff540",
                    "useFieldValueForLabel": true
                }
            ],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Choice Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Choice",
            "fieldValue": null,
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": null,
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Teams Function",
            "name": "teams_function",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": false,
            "sequence": 0,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "78b972e006284f708b260e16a16bc5c9",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "${ops_task_name}",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Job Name to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Job Name",
            "name": "jobname",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 1,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "315c1cceff7b4461993d1d5683431801",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": true,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 2",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "${ops_status}",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Job Status to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Job Status",
            "name": "jobstatus",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 2,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "c1fa2b89a6b441ebbe5a6cbf61989ce4",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 3",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "https://stonebranch365.webhook.office.com/webhookb2/dbc988a0-69eb-45b9-b70a-569906b07c23@74d8ca68-991f-47c9-bb24-f85b441cc605/IncomingWebhook/b9c6df76d67e443085ee29afdcee3b8b/f777a5f6-c742-4203-8a50-05f33330ca91",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Incoming Webhook of the MS Teams Channel",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "MS Teams Webhook",
            "name": "teams_webhook",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 3,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "bdf905a2d123452fac6de5d3569fe290",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 5",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "${ops_execution_user}",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Name of the execution user to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Execution User",
            "name": "exec_user",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 5,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "17bf47ef33224f82942c80d00972dc90",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 6",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "${ops_task_type}",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Type of Job to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Job Type",
            "name": "job_type",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 6,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "59fedf57a3c04d4ebe31ebd917708f24",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 7",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "Task Notification",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Message to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Message Title",
            "name": "title",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 7,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "78cf52a8ad0b45d698c4eba17a01bd16",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 8",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": "You can refer to the following details for updates on the current Task",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": "Message to be notified in MS Teams",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Message Text",
            "name": "text",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": false,
            "sequence": 8,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "1e51fdf030c84f9caf64c4b443d460e4",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 4",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": null,
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": false,
            "hint": null,
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "API Endpoint",
            "name": "api_endpoint",
            "noSpaceIfHidden": true,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": true,
            "required": false,
            "sequence": 9,
            "showIfField": "Choice Field 1",
            "showIfFieldValue": "Approval Notification",
            "sysId": "c79590b61f0a4f7ca2b8fa6d3108dccd",
            "textType": "Plain"
        }
    ],
    "logLevel": "Inherited",
    "name": "Microsoft Teams Integration",
    "outputConditionOperator": "=",
    "outputConditionStrategy": "Match Any",
    "outputConditionValue": null,
    "outputContentType": null,
    "outputFailureOnly": false,
    "outputPathExpression": null,
    "outputReturnFile": null,
    "outputReturnNline": "100",
    "outputReturnSline": "1",
    "outputReturnText": null,
    "outputReturnType": "NONE",
    "outputType": "STDOUT",
    "runtimeDir": null,
    "script": "#!/usr/bin/python3\n# C:\\Program Files\\Python37\\\n#\n#        Origins: Stonebranch GmbH\n#        Author: Ioanna Kyriazidou\n#                Karthik Mohan\n#\n#        Version History:    1.0     IK     07-Nov-2019     Initial Version (\n#                            Notification Functionality)\n#                            2.0     KM     03-Mar-2020     Adding\n#                            Approval Functionality\n#                            2.1     KM     23-Sep-2020 Variablized Parameters\n#                            2.2     KM     18-May-2021 Change in Teams Cards\n#\n#    Copyright (c) Stonebranch GmbH, 2019.  All rights reserved.\n#\n#    The copyright in this work is vested in Stonebranch.\n#    The information contained in this work (either in whole or in part)\n#    is confidential and must not be modified, reproduced, disclosed or\n#    disseminated to others or used for purposes other than that for which\n#    it is supplied, without the prior written permission of Stonebranch.\n#    If this work or any part hereof is furnished to a third party by\n#    virtue of a contract with that party, use of this work by such party\n#    shall be governed by the express contractual terms between Stonebranch,\n#    which is party to that contract and the said party.\n#\n#    The information in this document is subject to change without notice\n#    and should not be construed as a commitment by Stonebranch. Stonebranch\n#    assumes no responsibility for any errors that may appear in this document.\n#    With the appearance of a new version of this document all older versions\n#    become invalid.\n#\n# Importing required packages\nimport logging\nimport sys\nimport argparse\nimport uuid\nimport time\nimport datetime\nimport json\nimport re\nimport urllib3\nimport requests\n\nversion = \"2.1\"\n\n\n# initialize() function helps to parse the arguments passed form the\n# Universal Controller\ndef initialize():\n    global argparse, logging, sys, requests, uuid, time, datetime, json, re, \\\n        log_date, args\n    parser = argparse.ArgumentParser(\n        description='Purpose : Teams Notification Universal Task')\n    # ## --> Capture Universal Task Form Variables Here\n    parser.add_argument(\"--uc_teams_function\",\n        default=\"${ops_mst_teams_function}\")\n    parser.add_argument(\"--uc_job_name\", default=\"${ops_mst_jobname}\")\n    parser.add_argument(\"--uc_job_status\", default=\"${ops_mst_jobstatus}\")\n    parser.add_argument(\"--uc_teams_incoming_webhook\",\n        default=\"${ops_mst_teams_webhook}\")\n    parser.add_argument(\"--uc_exec_user\", default=\"${ops_mst_exec_user}\")\n    parser.add_argument(\"--uc_description\", default=\"${ops_mst_description\")\n    parser.add_argument(\"--uc_job_type\", default=\"${ops_mst_jobtype}\")\n    parser.add_argument(\"--uc_title\", default=\"${ops_mst_title}\")\n    parser.add_argument(\"--uc_api_endpoint\", default=\"${ops_mst_api_endpoint}\")\n    # parser.add_argument(\"--UC_description\", default=\"${ops_mst_description}\")\n    # ## -->\n    parser.add_argument(\"--logginglevel\", default=\"${ops_logic_logginglevel}\")\n    args = parser.parse_args()\n    global uc_text\n    uc_text = \"${ops_mst_text}\"\n    # -- Setup Logging\n    numeric_level = getattr(logging, args.logginglevel.upper(), None)\n    logging.basicConfig(format='%(asctime)-15s - %(levelname)-8s - %(message)s',\n        level=logging.INFO)\n    # -- Print Paramater Values\n    logging.debug(\n        \"Executing version {0} with the following parameters : {1}\".format(\n            version, args))\n    # -- Ignore Https Warnings\n    urllib3.disable_warnings()\n    # -- Setup LogDate for Trigger Log Search\n    log_date = json.dumps(datetime.datetime.now().isoformat())\n\n\n# approval_notification() function helps to send approval notification to the\n# teams incoming web-channel\ndef approval_notification():\n    print(\"Approval Function for Teams\")\n    webhook = args.uc_teams_incoming_webhook\n    team_data = {\n        \"@type\": \"MessageCard\",\n        \"@context\": \"https://schema.org/extensions\",\n        \"summary\": \"This is the summary property\",\n        \"themeColor\": \"#008000\",\n        \"sections\": [\n            {\n                \"activityTitle\": \"**Pending approval**\"\n            },\n            {\n                \"startGroup\": True,\n                \"title\": \"\" + args.uc_title,\n                \"color\": \"10,10,10\",\n                \"activityTitle\": \"**Approval Needed for:** \" + args.uc_job_name,\n                \"activitySubtitle\": \"Please review the approval request\",\n                \"facts\": [\n                    {\n                        \"name\": \"Job Status:\",\n                        \"value\": \"\" + args.uc_job_status\n                    },\n                    {\n                        \"name\": \"Executed by:\",\n                        \"value\": \"\" + args.uc_exec_user\n                    },\n                    {\n                        \"name\": \"Description:\",\n                        \"value\": \"\" + uc_text\n                    },\n                ]\n            },\n            {\n                \"potentialAction\": [\n                    {\n                        \"@type\": \"ActionCard\",\n                        \"name\": \"Approve\",\n                        \"color\": \"#008000\",\n                        \"inputs\": [\n                            {\n                                \"@type\": \"TextInput\",\n                                \"id\": \"comment\",\n                                \"isMultiline\": True,\n                                \"title\": \"Reason (optional)\"\n                            }\n                        ],\n                        \"actions\": [\n                            {\n                                \"@type\": \"HttpPOST\",\n                                \"name\": \"Submit\",\n                                \"target\": \"\" + args.uc_api_endpoint,\n                                \"body\": \"Approved\" + \":\" + args.uc_job_name,\n                                \"CARD-UPDATE-IN-BODY\": True,\n                                \"CARD-ACTION-STATUS\": \"The Request is \"\n                                                      \"Approved for the \"\n                                                      \"Task:\" + args.uc_job_name\n                            }\n                        ]\n                    },\n                    {\n                        \"@type\": \"ActionCard\",\n                        \"name\": \"Reject\",\n                        \"inputs\": [\n                            {\n                                \"@type\": \"TextInput\",\n                                \"id\": \"comment\",\n                                \"isMultiline\": True,\n                                \"title\": \"Reason (optional)\"\n                            }\n                        ],\n                        \"actions\": [\n                            {\n                                \"@type\": \"HttpPOST\",\n                                \"name\": \"Submit\",\n                                \"target\": \"\" + args.uc_api_endpoint,\n                                \"body\": \"Rejected\" + \":\" + args.uc_job_name,\n                                \"CARD-UPDATE-IN-BODY\": True,\n                                \"CARD-ACTION-STATUS\": \"The Request is \"\n                                                      \"Rejectec for the \"\n                                                      \"Task:\" + args.uc_job_name\n                            }\n                        ]\n                    }\n                ]\n            },\n        ]\n    }\n    response = requests.post(webhook, data=json.dumps(team_data),\n        headers={'Content-Type': 'application/json'})\n    print(response.status_code)\n\n\n# send_notification() function helps to send task notification to the\n# teams incoming web-channel\ndef send_notification():\n    print(\"Notification Function for Microsoft Teams\")\n    webhook = args.uc_teams_incoming_webhook\n    team_notification_data = {\n        \"@type\": \"MessageCard\",\n        \"@context\": \"https://schema.org/extensions\",\n        \"summary\": \"This is the summary property\",\n        \"themeColor\": \"0075FF\",\n        \"sections\": [\n            {\n                \"activityTitle\": \"\" + args.uc_title,\n                \"activitySubtitle\": \"\" + uc_text\n            },\n            {\n                \"startGroup\": True,\n                \"title\": \"**Notification for Microsoft Teams**\",\n                \"facts\": [\n                    {\n                        \"name\": \"Job Status:\",\n                        \"value\": \"\" + args.uc_job_status\n                    },\n                    {\n                        \"name\": \"Executed by:\",\n                        \"value\": \"\" + args.uc_exec_user\n                    },\n                    {\n                        \"name\": \"Description:\",\n                        \"value\": \"\" + uc_text\n                    },\n                ]\n            },\n        ]\n    }\n    response = requests.post(webhook, data=json.dumps(team_notification_data),\n        headers={'Content-Type': 'application/json'})\n    print(response.status_code)\n\n\nif __name__==\"__main__\":\n    logging.info(\"Microsoft Teams Notifications process started...\")\n    initialize()\n    logging.info(\"Initialzing complete\")\n    if args.uc_teams_function==\"Send Message\":\n        logging.info(\"Prepare message for Teams Channel\")\n        send_notification()\n        logging.info(\"Microsoft Teams Notifications process finished...\")\n    if args.uc_teams_function==\"Approval Notification\":\n        logging.info(\"Prepare Approval Notification for Teams Channel\")\n        approval_notification()",
    "scriptTypeWindows": "uapy",
    "scriptUnix": null,
    "scriptWindows": null,
    "sendVariables": "None",
    "sysId": "6b06e1f437c443e0bb2d58f42c15c00e",
    "templateType": "Script",
    "useCommonScript": true,
    "variablePrefix": "mst",
    "waitForOutput": false
}