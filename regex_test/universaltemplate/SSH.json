{
    "agent": null,
    "agentCluster": null,
    "agentClusterVar": null,
    "agentFieldsRestriction": "No Restriction",
    "agentType": "Any",
    "agentVar": null,
    "alwaysCancelOnFinish": false,
    "autoCleanup": false,
    "automaticOutputRetrievalFieldsRestriction": "No Restriction",
    "broadcastCluster": null,
    "broadcastClusterVar": null,
    "commands": [],
    "createConsole": false,
    "credentialFieldsRestriction": "No Restriction",
    "credentials": null,
    "credentialsVar": null,
    "description": "Execute Command or Script on Remote Server with no UC Agent Installed, Remote Server Requires an SSH Server.",
    "desktopInteract": false,
    "elevateUser": false,
    "environment": [],
    "environmentVariablesFieldsRestriction": "No Restriction",
    "events": [],
    "exitCodeOutput": null,
    "exitCodeProcessing": "Success Exitcode Range",
    "exitCodeProcessingFieldsRestriction": "No Restriction",
    "exitCodeText": null,
    "exitCodes": "0",
    "exportReleaseLevel": "7.4.0.0",
    "extension": null,
    "fields": [
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Text Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": null,
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Remote SSH Server",
            "name": "host",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 0,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "bb3f418e7e8241388d4f599fb80158f6",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Integer Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Integer",
            "fieldValue": "22",
            "formColumnSpan": 1,
            "formEndRow": true,
            "formStartRow": false,
            "hint": "Port for Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Remote SSH Port",
            "name": "port",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 1,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "cb70e08a62604e83ab7442d189ab2fa2",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Credential Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Credential",
            "fieldValue": null,
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Login Credentials for Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Remote SSH Credential",
            "name": "credential",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": true,
            "sequence": 2,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "348504352ae3426eaf9fa989b9f822e2",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [
                {
                    "fieldValue": "Command",
                    "sequence": 0,
                    "sysId": "a6c80de5e0d94700af720aa5481cf8d6",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Script",
                    "sequence": 1,
                    "sysId": "e1bf8f3bfd264d7aad0959f3dfdfe7b0",
                    "useFieldValueForLabel": true
                }
            ],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Choice Field 2",
            "fieldRestriction": "No Restriction",
            "fieldType": "Choice",
            "fieldValue": "Command",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Select if Command or Script to be Executed on Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Command or Script",
            "name": "type",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": false,
            "sequence": 5,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "ffaf38e424d548899186123ed65d47c3",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Large Text Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Text",
            "fieldValue": null,
            "formColumnSpan": 3,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Command to be Executed on Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Command",
            "name": "command",
            "noSpaceIfHidden": true,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": true,
            "required": false,
            "sequence": 6,
            "showIfField": "Choice Field 2",
            "showIfFieldValue": "Command",
            "sysId": "9a1f6a8ccf744015b42562f37713bc87",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Script Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Script",
            "fieldValue": null,
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Script to be executed on Remote SSH Server",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Script",
            "name": "script",
            "noSpaceIfHidden": true,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": true,
            "required": false,
            "sequence": 7,
            "showIfField": "Choice Field 2",
            "showIfFieldValue": "Script",
            "sysId": "326ec488c4f644538b29fae842f430c5",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [
                {
                    "fieldValue": "Unix",
                    "sequence": 0,
                    "sysId": "3d7f21491e9c4df89e4bc2092bbf0dee",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Windows",
                    "sequence": 1,
                    "sysId": "424f0e91e3634b1da841233fa3d9372f",
                    "useFieldValueForLabel": true
                }
            ],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Choice Field 3",
            "fieldRestriction": "No Restriction",
            "fieldType": "Choice",
            "fieldValue": "Unix",
            "formColumnSpan": 1,
            "formEndRow": true,
            "formStartRow": false,
            "hint": "Type of OS (Unix or Windows) that the script will execute on",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Script OS Type",
            "name": "os",
            "noSpaceIfHidden": true,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": false,
            "sequence": 8,
            "showIfField": "Choice Field 2",
            "showIfFieldValue": "Script",
            "sysId": "a33efd001adc41f89d9f488ee8732949",
            "textType": "Plain"
        },
        {
            "arrayFieldValue": [],
            "arrayNameTitle": null,
            "arrayValueTitle": null,
            "booleanNoValue": null,
            "booleanValueType": "true/false",
            "booleanYesValue": null,
            "choiceAllowEmpty": false,
            "choiceAllowMultiple": false,
            "choiceDynamic": false,
            "choiceFields": [],
            "choiceSortOption": "Sequence",
            "choices": [
                {
                    "fieldValue": "NotSet",
                    "sequence": 0,
                    "sysId": "704497f8a5ee477aa73325bddcfb7f64",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Info",
                    "sequence": 1,
                    "sysId": "04a244d3c774467ca33f8b4be3e18341",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Debug",
                    "sequence": 2,
                    "sysId": "d1a3819807a5453cb8ea121956cf07de",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Warning",
                    "sequence": 3,
                    "sysId": "eec7c8f58c6649928c56c862d41bf103",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Error",
                    "sequence": 4,
                    "sysId": "e4bd43f121e041aba5eab4ad463f9b00",
                    "useFieldValueForLabel": true
                },
                {
                    "fieldValue": "Critical",
                    "sequence": 5,
                    "sysId": "8089e21711594277b93e4e5f637a782a",
                    "useFieldValueForLabel": true
                }
            ],
            "defaultListView": false,
            "extensionStatus": false,
            "fieldLength": null,
            "fieldMapping": "Choice Field 1",
            "fieldRestriction": "No Restriction",
            "fieldType": "Choice",
            "fieldValue": "NotSet",
            "formColumnSpan": 1,
            "formEndRow": false,
            "formStartRow": true,
            "hint": "Controls messages issued from the Universal Task Script",
            "intFieldMax": null,
            "intFieldMin": null,
            "label": "Logging Level",
            "name": "loglevel",
            "noSpaceIfHidden": false,
            "preserveOutputOnRerun": false,
            "preserveValueIfHidden": false,
            "requireIfField": null,
            "requireIfFieldValue": null,
            "requireIfVisible": false,
            "required": false,
            "sequence": 9,
            "showIfField": null,
            "showIfFieldValue": null,
            "sysId": "64eacf8b126440ec912ce059a168646c",
            "textType": "Plain"
        }
    ],
    "logLevel": "Inherited",
    "name": "SSH",
    "outputConditionOperator": "=",
    "outputConditionStrategy": "Match Any",
    "outputConditionValue": null,
    "outputContentType": null,
    "outputFailureOnly": false,
    "outputPathExpression": null,
    "outputReturnFile": null,
    "outputReturnNline": "100",
    "outputReturnSline": "1",
    "outputReturnText": null,
    "outputReturnType": "NONE",
    "outputType": "STDOUT",
    "runtimeDir": null,
    "script": "#!/opt/universal/python3.6/bin/python3\n# --\n#         Origins: Stonebranch\n#          Author: Colin Cocksedge colin.cocksedge@stonebranch.com\n#            Date: 14-Aug-2018\n#\n#    Copyright (c) Stonebranch, 2020.  All rights reserved.\n#\npurpose = \"Python SSH Client to Execute Command or Script on Remote Server\"\nversion = \"2.1\"\n#           Version History:    2.0     CCO     22-Oct-2019      Refactored using Paramiko\n#           Version History:    2.1     CCO     04-Dec-2019      Addded Support for Key Location and Passphrase Functions (UC 6.8) \n# --\n\n# -- Main Logic Function\ndef main():\n    ScriptSetup()  # -- Import Required Modules, Setup Logging Format, Set Variables\n    SSHConnect()  # -- Connect to Remote SSH Server and Authenticate\n    if args.type == \"Script\":  # -- If script provided copy to Remote SSH Server\n        CopyScript()  # -- Transfer Script to Remote SSH Server\n    RunCommand()  # -- Execute Command on Remote SSH Server\n    if args.type == \"Script\":  # -- If script provided remove from Remote SSH Server\n        RemoveScript()  # -- Remove Script from Remote SSH Server\n    session.close()\n    sys.exit(exit_code)  # -- Exit with Remote Exit Code\n\n\n# --\n\n# -- Import Required Modules, Setup Logging Format, Set Variables\ndef ScriptSetup():\n    # -- Import required python modules\n    import argparse\n    import logging\n    import sys\n    import os\n    import uuid\n\n    # -- Import ssh2, if error then install ssh2-python\n    try:\n        import paramiko\n    except:\n        try:\n            from pip import main as pipmain\n        except:\n            from pip._internal import main as pipmain\n        pipmain(\n            [\n                \"install\",\n                \"--trusted-host=pypi.python.org\",\n                \"--trusted-host=pypi.org\",\n                \"--trusted-host=files.pythonhosted.org\",\n                \"paramiko\",\n            ]\n        )\n        import paramiko\n    global argparse, logging, sys, paramiko, os, uuid\n    # -- Set Variables from Universal Task Form or Command Line Input\n    parser = argparse.ArgumentParser(description=\"Purpose : {0}\".format(purpose))\n    # ## --> Capture Universal Task Form Variables Here\n    parser.add_argument(\n        \"--host\",\n        default=r\"${ops_ussh_host}\",\n        help=\"Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--port\",\n        type=int,\n        default=\"${ops_ussh_port}\",\n        help=\"Port for Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--username\",\n        default=\"${_credentialUser('${ops_ussh_credential}')}\",\n        help=\"Username for Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--password\",\n        default=\"${_credentialPwd('${ops_ussh_credential}')}\",\n        help=\"Password for Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--privatekey\",\n        default=r\"${_credentialKeyLoc('${ops_ussh_credential}')}\",\n        help=\"Location of the SSH Private Key\"\n    )\n    parser.add_argument(\n        \"--passphrase\",\n        default=\"${_credentialPassphrase('${ops_ussh_credential}')}\",\n        help=\"Password for SSH private Key\"\n    )\n    parser.add_argument(\n        \"--type\",\n        default=\"${ops_ussh_type}\",\n        help=\"Select if Remote Command or Local Script to be Executed on Remote SSH Server\",\n        choices=['Command','Script']\n    )\n    parser.add_argument(\n        \"--command\",\n        default=\"${ops_ussh_command}\",\n        help=\"Command to be Executed on Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--script\",\n        default=r\"${_scriptpath('${ops_ussh_script}')}\",\n        help=\"Location of Local Script to be executed on Remote SSH Server\"\n    )\n    parser.add_argument(\n        \"--os\",\n        default=r\"${ops_ussh_os}\",\n        help=\"Type of OS (Unix or Windows) that the script will execute on\",\n        choices=['Unix','Windows']\n    )\n    # ## -->\n    parser.add_argument(\n        \"--loglevel\",\n        default=\"${ops_ussh_loglevel}\",\n        help=\"Controls messages issued from the Script\",\n        choices=[\"None\",\"Info\",\"Debug\",\"Warning\",\"Critical\"]\n    )\n    global args\n    args = parser.parse_args()\n    # -- Setup Logging\n    numeric_level = getattr(logging, args.loglevel.upper(), None)\n    logging.basicConfig(\n        format=\"%(asctime)-15s - %(levelname)-8s - %(message)s\", level=numeric_level\n    )\n    # -- Print Paramater Values\n    logging.debug(\n        \"Executing version {0} with the following parameters : {1}\".format(\n            version, args\n        )\n    )\n\n\n# --\n\n# ## --> Functions Go Here\n\n# -- Connect to Remote SSH Server and Authenticate\ndef SSHConnect():\n    logging.info(\"Connect to Host = {0} on Port = {1}\".format(args.host, args.port))\n\n    global session\n    try:\n        session = paramiko.SSHClient()\n        session.load_system_host_keys()\n        session.set_missing_host_key_policy(paramiko.AutoAddPolicy())\n    except:\n        logging.error(\n            \"Error Connecting to Remote SSH Server {0}\".format(sys.exc_info()[0])\n        )\n        sys.exit(1)\n    # Authenticate to SSH Server\n    if len(args.privatekey) != 0 and str(args.privatekey[0][:1]) != \"$\":\n        # Authenticate with Public Key\n        # Check if Privatekey file exists\n        if not os.path.isfile(args.privatekey):\n            logging.error(\"No such private key {0}\".format(args.privatekey))\n            sys.exit(1)\n        try:\n            if str(args.privatekey[0][:1]) != \"$\":\n                # Private Key with Passphrase\n                session.connect(args.host, port=args.port, username=args.username, passphrase=args.passphrase, key_filename=args.privatekey)\n            else:\n                # Private Key without Passphrase\n                session.connect(args.host, port=args.port, username=args.username, key_filename=args.privatekey)\n        except:\n            logging.error(\n                \"Error Connecting to Remote SSH Server {0}\".format(sys.exc_info()[0])\n            )\n            sys.exit(1)\n    else:\n        # Authenticate with User and Password\n        try:\n            session.connect(args.host, port=args.port, username=args.username, password=args.password)\n        except:\n            logging.error(\n                \"Error Connecting to Remote SSH Server {0}\".format(sys.exc_info()[0])\n            )\n            sys.exit(1)\n\n\n# --\n# -- Execute Command on Remote SSH Server\ndef RunCommand():\n    try:\n        channel = session.get_transport().open_session()\n        channel.exec_command(args.command)\n        channel.shutdown_write()\n    except:\n        logging.error(\n            \"Error Executing Command on Remote SSH Server {0}\".format(sys.exc_info()[0])\n        )\n        sys.exit(1)\n    stdout = channel.makefile().read()\n    stderr = channel.makefile_stderr().read()\n    global exit_code\n    exit_code = channel.recv_exit_status()\n    channel.close()\n    # Print STDOUT and STDERR\n    print(stdout.decode('utf-8'))\n    print(stderr.decode('utf-8'))\n    logging.info(\"RunCommand Exit status = {0}\".format(exit_code))\n\n\n# --\n# -- Transfer Script to Remote SSH Server\ndef CopyScript():\n    global temp_script\n    filename, file_extension = os.path.splitext(args.script)\n    if args.os == \"Windows\" and file_extension == \"\":\n        logging.error(\"Windows Script File does not have an extension\")\n        sys.exit(1)\n    temp_script = uuid.uuid1()\n    temp_script = str(temp_script.int) + file_extension\n    with open(args.script, \"r\", encoding=None, newline=None) as script_file:\n        for data in script_file:\n            try:\n                channel = session.get_transport().open_session()\n                channel.exec_command(\"echo \" + data.strip() + \" >> \" + temp_script)\n                channel.close()\n            except:\n                logging.error(\"Error Writing Script File on Remote SSH Server {0}\".format(sys.exc_info()[0]))\n                sys.exit(1)\n    if args.os == \"Unix\":\n        try:\n            channel = session.get_transport().open_session()\n            channel.exec_command(\"chmod 777 \" + temp_script)\n            channel.close()\n        except:\n            logging.error(\n                \"Error Making Script File on Remote SSH Server Executable {0}\".format(\n                    sys.exc_info()[0]\n                )\n            )\n            sys.exit(1)\n        args.command = \"./\" + temp_script\n    else:\n        args.command = \".\\\\\" + temp_script\n\n\n# --\n# -- Remove Script from Remote SSH Server\ndef RemoveScript():\n    if args.os == \"Unix\":\n        try:        \n            channel = session.get_transport().open_session()\n            channel.exec_command(\"rm \" + temp_script)\n            channel.close()\n        except:\n            logging.error(\"Error Removing Script File from Remote SSH Server Executable {0}\".format(sys.exc_info()[0]))\n            sys.exit(1)\n    else:\n        try:\n            channel = session.get_transport().open_session()\n            channel.exec_command(\"del \" + temp_script)\n            channel.close()\n        except:\n            logging.error(\n                \"Error Removing Script File from Remote SSH Server Executable {0}\".format(\n                    sys.exc_info()[0]\n                )\n            )\n            sys.exit(1)\n# --\n# -->\n# -- Execute\nmain()",
    "scriptTypeWindows": "uapy",
    "scriptUnix": null,
    "scriptWindows": null,
    "sendVariables": "None",
    "sysId": "47b64f15dd674e53b6b05c4e3678afbb",
    "templateType": "Script",
    "useCommonScript": true,
    "variablePrefix": "ussh",
    "waitForOutput": false
}